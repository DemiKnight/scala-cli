"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1119],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(t),m=i,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return t?a.createElement(f,o(o({ref:n},p),{},{components:t})):a.createElement(f,o({ref:n},p))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},9438:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var a=t(3117),i=t(102),r=(t(7294),t(3905)),o=["components"],l={title:"Offline mode \u26a1\ufe0f",sidebar_position:51},s=void 0,c={unversionedId:"guides/offline",id:"guides/offline",title:"Offline mode \u26a1\ufe0f",description:"Offline mode is an experimental feature.",source:"@site/docs/guides/offline.md",sourceDirName:"guides",slug:"/guides/offline",permalink:"/docs/guides/offline",draft:!1,editUrl:"https://github.com/Virtuslab/scala-cli/edit/main/website/docs/guides/offline.md",tags:[],version:"current",sidebarPosition:51,frontMatter:{title:"Offline mode \u26a1\ufe0f",sidebar_position:51},sidebar:"tutorialSidebar",previous:{title:"SBT and Mill \u26a1\ufe0f",permalink:"/docs/guides/sbt-mill"},next:{title:"Repositories and HTTP Proxies \u26a1\ufe0f",permalink:"/docs/guides/repositories"}},p={},u=[{value:"How to use the offline mode",id:"how-to-use-the-offline-mode",level:2},{value:"Changes in behaviour",id:"changes-in-behaviour",level:2},{value:"Scala artifacts",id:"scala-artifacts",level:3},{value:"JVM artifacts",id:"jvm-artifacts",level:3},{value:"Bloop artifacts",id:"bloop-artifacts",level:3},{value:"Dependency artifacts",id:"dependency-artifacts",level:3},{value:"Setting up the environment",id:"setting-up-the-environment",level:2},{value:"Setting up the environment manually",id:"setting-up-the-environment-manually",level:3},{value:"Testing offline mode",id:"testing-offline-mode",level:2},{value:"Clearing coursier&#39;s caches",id:"clearing-coursiers-caches",level:2}],d={toc:u};function m(e){var n=e.components,t=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Offline mode is an experimental feature."),(0,r.kt)("p",{parentName:"admonition"},"Please bear in mind that non-ideal user experience should be expected.\nIf you encounter any bugs or have feedback to share, make sure to reach out to the maintenance team\non ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/VirtusLab/scala-cli"},"GitHub"),".")),(0,r.kt)("p",null,"The offline mode for Scala CLI was introduced to be used in two situations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"you want to have more control over the artifacts being downloaded"),(0,r.kt)("li",{parentName:"ul"},"your development environment has restricted access to the Internet or certain web domains")),(0,r.kt)("p",null,"In this mode Scala CLI will only use local artifacts cached by coursier. Any attempts to download artifacts will fail unless they're available locally in cache or there is a known fallback.\nThis applies to everything that Scala CLI normally manages behind the scenes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Scala language and compiler artifacts"),(0,r.kt)("li",{parentName:"ul"},"JVM artifacts"),(0,r.kt)("li",{parentName:"ul"},"Bloop artifacts"),(0,r.kt)("li",{parentName:"ul"},"dependency artifacts")),(0,r.kt)("h2",{id:"how-to-use-the-offline-mode"},"How to use the offline mode"),(0,r.kt)("p",null,"To enable offline mode pass the ",(0,r.kt)("inlineCode",{parentName:"p"},"--offline")," flag to Scala CLI, e.g.:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"scala-cli run Main.scala --offline\n")),(0,r.kt)("p",null,"It is also possible to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"COURSIER_MODE")," environment variable or ",(0,r.kt)("inlineCode",{parentName:"p"},"coursier.mode")," java property."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"export COURSIER_MODE=offline\n")),(0,r.kt)("p",null,"or"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"scala-cli -Dcoursier.mode=offline run Main.scala \n")),(0,r.kt)("h2",{id:"changes-in-behaviour"},"Changes in behaviour"),(0,r.kt)("h3",{id:"scala-artifacts"},"Scala artifacts"),(0,r.kt)("p",null,"In offline mode Scala CLI will not perform any validation of the Scala version specified in the project, it will not be checked if such a version has been released."),(0,r.kt)("h3",{id:"jvm-artifacts"},"JVM artifacts"),(0,r.kt)("p",null,"System JVM will be used or it will be fetched from local cache.\nIf a different JVM version than the system one is required, it is best to export it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"JAVA_HOME")," environment variable.\nIt is important to know, that currently if a version is specified with ",(0,r.kt)("inlineCode",{parentName:"p"},"--jvm")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"using jvm")," Scala CLI will ignore the system JVM and try to fetch via coursier."),(0,r.kt)("p",null,"To start the Bloop server a JVM with version above 17 is required, if it can't be found compilation will fall back to using ",(0,r.kt)("inlineCode",{parentName:"p"},"scalac")," instead."),(0,r.kt)("h3",{id:"bloop-artifacts"},"Bloop artifacts"),(0,r.kt)("p",null,"If no artifacts for Bloop are available compilation falls back to using ",(0,r.kt)("inlineCode",{parentName:"p"},"scalac")," instead."),(0,r.kt)("h3",{id:"dependency-artifacts"},"Dependency artifacts"),(0,r.kt)("p",null,"Any attempt to download a dependency will fail, so it is required to have all the dependencies cached locally before compiling."),(0,r.kt)("p",null,"Dependencies that reside in local repositories like ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.ivy2/local")," will be resolved as usual."),(0,r.kt)("h2",{id:"setting-up-the-environment"},"Setting up the environment"),(0,r.kt)("p",null,"The easiest way to set up the environment is to use ",(0,r.kt)("a",{parentName:"p",href:"https://get-coursier.io"},"Coursier"),"."),(0,r.kt)("p",null,"Installing scala artifacts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"cs install scala:3.3.0 scalac:3.3.0\n")),(0,r.kt)("p",null,"Installing a JVM:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"cs java --jvm 17\n")),(0,r.kt)("p",null,"Using the two commands above is already enough for running and compiling code using ",(0,r.kt)("inlineCode",{parentName:"p"},"scalac"),".\nFor fetching code dependencies run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"cs fetch com.lihaoyi::os-lib::0.9.1\n")),(0,r.kt)("p",null,"Note that the dependency format is the same as for ",(0,r.kt)("inlineCode",{parentName:"p"},"--dep")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"using dep"),". More information about it ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/dependencies"},"here"),"."),(0,r.kt)("p",null,"If you want to use Bloop, you can get it with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"cs fetch io.github.alexarchambault.bleep:bloop-frontend_2.12:1.5.11-sc-2 \n")),(0,r.kt)("p",null,"Note that Scala CLI uses a custom fork of Bloop, so simple ",(0,r.kt)("inlineCode",{parentName:"p"},"cs install bloop")," won't work."),(0,r.kt)("h3",{id:"setting-up-the-environment-manually"},"Setting up the environment manually"),(0,r.kt)("p",null,"It is possible to copy the Scala language artifacts and dependencies to the local Coursier's cache manually.\nThis can be done by creating a directory structure like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"COURSIER_CACHE_PATH\n\u2514\u2500\u2500 https\n    \u2514\u2500\u2500 repo1.maven.org\n        \u2514\u2500\u2500 maven2\n            \u2514\u2500\u2500 org\n                \u2514\u2500\u2500 scala-lang\n                    \u2514\u2500\u2500 scala-compiler\n                        \u2514\u2500\u2500 2.13.12\n                            \u251c\u2500\u2500 scala-compiler-2.13.12-sources.jar (OPTIONAL)\n                            \u251c\u2500\u2500 scala-compiler-2.13.12.jar\n                            \u2514\u2500\u2500 scala-compiler-2.13.12.pom\n")),(0,r.kt)("p",null,"Path on MacOs ",(0,r.kt)("inlineCode",{parentName:"p"},"~/Library/Caches/Coursier/v1/https/repo1.maven.org/maven2/org/scala-lang/scala-compiler/2.13.12")),(0,r.kt)("p",null,"Same for a library:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"COURSIER_CACHE_PATH\n\u2514\u2500\u2500 https\n    \u2514\u2500\u2500 repo1.maven.org\n        \u2514\u2500\u2500 maven2\n            \u2514\u2500\u2500 com\n                \u2514\u2500\u2500 lihaoyi\n                    \u2514\u2500\u2500 os-lib_3\n                        \u2514\u2500\u2500 0.9.1\n                            \u251c\u2500\u2500 os-lib_3-0.9.1-sources.jar (OPTIONAL)\n                            \u251c\u2500\u2500 os-lib_3-0.9.1.jar\n                            \u2514\u2500\u2500 os-lib_3-0.9.1.pom\n")),(0,r.kt)("p",null,"Path on MacOS ",(0,r.kt)("inlineCode",{parentName:"p"},"~/Library/Caches/Coursier/v1/https/repo1.maven.org/maven2/com/lihaoyi/os-lib_3/0.9.1")),(0,r.kt)("p",null,"The first segments after the ",(0,r.kt)("inlineCode",{parentName:"p"},"v1")," directory are the address of the repository from which the artifact was downloaded.\nThis part can effectively be ",(0,r.kt)("inlineCode",{parentName:"p"},"https/repo1.maven.org/maven2")," since maven central is the default repository to use.\nThe rest of the path is the artifact's organization (split by the '.' character) and version."),(0,r.kt)("h2",{id:"testing-offline-mode"},"Testing offline mode"),(0,r.kt)("p",null,"To perform a test of environment setup for offline mode, it may be useful to create a clean cache directory for coursier.\nTo do so, run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"mkdir test-coursier-cache\nexport COURSIER_CACHE=`pwd`/test-coursier-cache\n")),(0,r.kt)("p",null,"And proceed with setting up the environment as described above:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"ignore",ignore:!0},"# Should fail with:\n# [error]  Error downloading org.scala-lang:scala3-compiler_3:3.3.0\nscala-cli run Main.scala --jvm 11 --offline\ncs install scala:3.3.0 scalac:3.3.0\n\n# Could fail with:\n# Error while getting https://github.com/coursier/jvm-index/raw/master/index.json\n# But may also pass on MacOS ('/usr/libexec/java_home -v' is tried)\n# or if a JVM is cached in coursier's archive cache (this cache's location can't be overridden), you may want to clear it, see section below\nscala-cli run Main.scala --jvm 11 --offline\ncs java --jvm 11\n\n# Should pass with a warning:\n# [warn]  Offline mode is ON and Bloop could not be fetched from the local cache, using scalac as fallback\nscala-cli run Main.scala --jvm 11 --offline\ncs fetch io.github.alexarchambault.bleep:bloop-frontend_2.12:1.5.11-sc-2 \n\n# Should pass with a warning:\n# [warn]  Offline mode is ON and a JVM for Bloop could not be fetched from the local cache, using scalac as fallback\nscala-cli run Main.scala --jvm 11 --offline\ncs java 17\n\nShould pass with no warnings\nscala-cli run Main.scala --jvm 11 --offline\n")),(0,r.kt)("h2",{id:"clearing-coursiers-caches"},"Clearing coursier's caches"),(0,r.kt)("p",null,"Citing ",(0,r.kt)("a",{parentName:"p",href:"https://get-coursier.io/docs/cache#default-location"},"Coursier's docs"),": ",(0,r.kt)("br",null),"\nOn a system where only recent versions of coursier were ever run (>= 1.0.0-RC12-1, released on the 2017/10/31), the default cache location is platform-dependent:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"on Linux, ",(0,r.kt)("inlineCode",{parentName:"li"},"~/.cache/coursier/v1"),". This also applies to Linux-based CI environments, and FreeBSD too"),(0,r.kt)("li",{parentName:"ul"},"on OS X, ",(0,r.kt)("inlineCode",{parentName:"li"},"~/Library/Caches/Coursier/v1")),(0,r.kt)("li",{parentName:"ul"},"on Windows, ",(0,r.kt)("inlineCode",{parentName:"li"},"%LOCALAPPDATA%\\Coursier\\Cache\\v1"),", which, for user Alex, typically corresponds to ",(0,r.kt)("inlineCode",{parentName:"li"},"C:\\Users\\Alex\\AppData\\Local\\Coursier\\Cache\\v1"))),(0,r.kt)("p",null,"So clearing the cache is just a matter of removing the ",(0,r.kt)("inlineCode",{parentName:"p"},"v1")," directory corresponding to the platform you're on.\nHowever, Coursier does use a second archive cache, which should be located in the same place as the ",(0,r.kt)("inlineCode",{parentName:"p"},"v1")," directory, e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.cache/coursier/arc"),",\nthis cache's location can't be overridden, so it may be necessary to clear it for proper testing."))}m.isMDXComponent=!0}}]);